#include <Wire.h>
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x3F, 16, 2); // LCD adresi 0x27 de olabilir

// Pin tanımları
const int motorButtonPin = 2;
const int seatBeltButtonPin = 3;
const int redLedPin = 5;
const int buzzerPin = 10;
const int potPin = A2;
const int fuelLedPin = 7;
const int motorLedPin = 13;
const int tempPin = A0; // LM35 sıcaklık sensörü
const int fanMotorPin = 9; // PH6, fan (DC motor)

bool motorDurumu = false;
bool oncekiButon = LOW;

void lcd_hazirla() {
  lcd.init();
  lcd.backlight();
   lcd.setCursor(0, 0);
  lcd.print("Test LCD");
  delay(2000);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Sistem Hazirlaniyor");
  delay(1500);
  lcd.clear();
}

void pin_hazirla() {
  pinMode(motorButtonPin, INPUT);
  pinMode(seatBeltButtonPin, INPUT_PULLUP);
  pinMode(redLedPin, OUTPUT);
  pinMode(buzzerPin, OUTPUT);
  pinMode(fuelLedPin, OUTPUT);
  pinMode(motorLedPin, OUTPUT);
  pinMode(fanMotorPin, OUTPUT);
}

void setup() {
  pin_hazirla();
  lcd_hazirla();
}

void loop() {
  int motorButton = digitalRead(motorButtonPin);
  int seatBelt = digitalRead(seatBeltButtonPin);
  int potDeger = analogRead(potPin);
  int yakitYuzde = map(potDeger, 0, 1023, 0, 100);

  int tempRaw = analogRead(tempPin);
  float voltage = (tempRaw / 1023.0) * 5.0;
  float sicaklik = voltage * 100.0;

  // SICAKLIK KONTROLÜ
  if (sicaklik >= 25.0) {
    digitalWrite(fanMotorPin, HIGH);
    lcd.setCursor(0, 0);
    lcd.print("Sicaklik: ");
    lcd.print((int)sicaklik);
    lcd.print((char)223); // derece sembolü
    lcd.print("C Fan Acik ");
    delay(1000);
  } else {
    digitalWrite(fanMotorPin, LOW);
    lcd.setCursor(0, 0);
    lcd.print("Sicaklik: ");
    lcd.print((int)sicaklik);
    lcd.print((char)223);
    lcd.print("C Fan Kapali");
    delay(1000);
  }

  if (yakitYuzde == 0) {
    motorDurumu = false;
    digitalWrite(motorLedPin, LOW);
    lcd.clear();
    lcd.setCursor(0, 0);
    lcd.print("Yakit Bitti");
    lcd.setCursor(0, 1);
    lcd.print("Motor Durdu");
    digitalWrite(fuelLedPin, LOW);
    digitalWrite(redLedPin, LOW);
    digitalWrite(buzzerPin, HIGH);
    delay(1500);
    return;
  }

  if (seatBelt == HIGH) {
    digitalWrite(redLedPin, HIGH);
    digitalWrite(buzzerPin, HIGH);
    lcd.clear();
    lcd.setCursor(0, 0);
    lcd.print("Kemer Takili Degil");
    lcd.setCursor(0, 1);
    lcd.print("Motor no       ");
    delay(1000);
    motorDurumu = false;
  } else {
    digitalWrite(redLedPin, LOW);
    digitalWrite(buzzerPin, LOW);
    lcd.setCursor(0, 0);
    lcd.print("Kemer Takildi     ");
    delay(1000);

    if (motorButton == HIGH && oncekiButon == LOW) {
      motorDurumu = !motorDurumu;
      lcd.clear();
      lcd.setCursor(0, 0);
      lcd.print(motorDurumu ? "Motor ok         " : "Motor Durdu      ");
      delay(1000);
    }
  }

  oncekiButon = motorButton;
  digitalWrite(motorLedPin, motorDurumu);

  lcd.setCursor(0, 1);
  lcd.print("Yakit: ");
  lcd.print(yakitYuzde);
  lcd.print("%   ");

  if (yakitYuzde <= 5) {
    lcd.setCursor(0, 0);
    lcd.print("Kritik: Yakit Az ");
    digitalWrite(fuelLedPin, millis() / 300 % 2);
  } else if (yakitYuzde <= 10) {
    lcd.setCursor(0, 0);
    lcd.print("Uyari: Yakit Az  ");
    digitalWrite(fuelLedPin, HIGH);
  } else {
    digitalWrite(fuelLedPin, LOW);
  }

  delay(200);
}
